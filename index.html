
<html lang="en">
    <head>
      <link href="site.css" rel="stylesheet">
    </head>
    <body>
      <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
      <script src="/socket.io/socket.io.js"></script>

      <!-- ORDERING IS IMPORTANT since document might not be ready.-->
      <div id="mapList">

        <div id="dust" class="map"> <img src="dust2.jpg" width=300px> dust11</div>

        <div id="mirage" class="map"><img src="mirage.jpg" width=300px>  mirage </div>

        <div id="cache" class="map"> <img src="cache.png" width=300px> cache </div>

        <div id="inferno" class="map"> <img src="inferno.jpg" width=300px> inferno </div>

      </div>

      <div id="rectangle" style="width:50px; height:50px; background-color:red"></div>


      You are: <div id="my_uuid"> Not connected!  </div>
      <br/>
      In command: <div id="position"> ERROR! </div>
      <!-- ORDERING IS IMPORTANT -->

      <script>

      // Create random uuid
      function guid() {
        function s4() {
          return Math.floor((1 + Math.random()) * 0x10000)
          .toString(16)
          .substring(1);
        }
        return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
        s4() + '-' + s4() + s4() + s4();
      }

      // function to grey out a specified div
      function greyDiv(map) {
        //grey out
        selector = "#" + map
        $(selector).css('background-color', 'grey');
        $(selector).css('opacity', '0.4');
        $(selector).unbind();
        //$(selector).css('cursor', 'none');
      }

      var current_position = 0 ;
      var total_maps = 4;
      var firstClient = 0 ;
      var inCharge = false;
      var mapHash = {}

      //Initiate connection to server
      var host = window.location.origin
      var socket = io.connect(host);

      socket.on('connect', function(data) {
        uuid = guid();
        socket.emit('add user', uuid);
        $("#my_uuid").text(uuid);
      });

      socket.on('order_changed',function(data){
        console.log(data + ' gets to choose');

        if ( uuid == data ) {
          $('#rectangle').css('background-color', 'green');
          inCharge = true;
        } else {
          $('#rectangle').css('background-color', 'red');
          inCharge = false;
        }
        $("#position").text(data);
      });

      // Whenever the server emits 'user joined', log it in the chat body
      socket.on('user joined', function (data) {
        console.log(data.username  + ' joined');
      });

      socket.on('user left', function (data) {
        console.log(data.username + ' left');
      });

      socket.on('map_selected', function (data) {
        console.log("Map "+ data + " was removed");
        greyDiv(data);
        --total_maps;
        if ( total_maps == 1 ) { inCharge = false; }
      });


      // Define buttons
      $('#dust').click(function() {
        if (inCharge) {
          socket.emit('make_selection' , { uuid : $("#my_uuid").text(), map : "dust"} );
        } else {
          console.log ("Tried to click without inCharge");
        }
      });

      $('#mirage').click(function() {
        if (inCharge) {
          socket.emit('make_selection' , { uuid : $("#my_uuid").text(), map : "mirage"});
        }else {
          console.log ("Tried to click without inCharge");
        }
      });

      $('#cache').click(function() {
        if (inCharge) {
          socket.emit('make_selection' , { uuid : $("#my_uuid").text(), map : "cache"});
        }else {
          console.log ("Tried to click without inCharge");
        }
      });

      $('#inferno').click(function() {
        if (inCharge) {
          socket.emit('make_selection' ,  { uuid : $("#my_uuid").text(), map : "inferno"});
        }else {
          console.log ("Tried to click without inCharge");
        }
      });


      </script>
    </body>
</html>
